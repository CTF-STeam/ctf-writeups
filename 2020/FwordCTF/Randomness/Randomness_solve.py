from Crypto.Util.number import *

output = [6680465291011788243, 5100570103593250421, 5906808313299165060, 1965917782737693358, 9056785591048864624, 1829758495155458576, 6790868899161600055, 1596515234863242823, 1542626304251881891, 8104506805098882719, 1007224930233032567, 3734079115803760073, 7849173324645439452, 8732100672289854567, 5175836768003400781, 1424151033239111460, 1199105222454059911, 1664215650827157105, 9008386209424299800, 484211781780518254, 2512932525834758909, 270126439443651096, 3183206577049996011, 3279047721488346724, 3454276445316959481, 2818682432513461896, 1198230090827197024, 6998819122186572678, 9203565046169681246, 2238598386754583423, 467098371562174956, 5653529053698720276, 2015452976526330232, 2551998512666399199, 7069788985925185031, 5960242873564733830, 8674335448210427234, 8831855692621741517, 6943582577462564728, 2159276184039111694, 8688468346396385461, 440650407436900405, 6995840816131325250, 4637034747767556143, 3074066864500201630, 3089580429060692934, 2636919931902761401, 5048459994558771200, 6575450200614822046, 666932631675155892, 3355067815387388102, 3494943856508019168, 3208598838604422062, 1651654978658074504, 1031697828323732832, 3522460087077276636, 6871524519121580258, 6523448658792083486, 127306226106122213, 147467006327822722, 3241736541061054362, 8781435214433157730, 7267936298215752831, 3411059229428517472, 6597995245035183751, 1256684894889830824, 6272257692365676430, 303437276610446361, 8730871523914292433, 6472487383860532571, 5022165523149187811, 4462701447753878703, 1590013093628585660, 4874224067795612706]
flag = [ord(x) for x in 'FwordCTF{']

olen = len(output)
x = [None] * olen
for i in range(9):
    x[i] = output[i] ^ flag[i]
print(x)

#y0 = x0 - x1
y = [None] * olen
for i in range(8):
    y[i] = x[i] - x[i + 1]
for i in range(7):
    print('%s a * %s = %s' % (i, y[i], y[i + 1]))

#z0 = inverse(y0, y1)
z = [None] * olen
for i in range(7):
    z[i] = inverse(y[i], y[i + 1])
    if z[i] != 1:
        print(i, z[i])

t = [0] * olen
for i in range(7):
    if z[i] != 1:
        t[i] = y[i] * z[i] // y[i + 1]
        print(i, t[i])

u = [0] * olen
v = [0] * olen
for i in range(6):
    if t[i] != 0:
        u[i] = y[i] * z[i] - t[i] * y[i + 1]
        v[i] = y[i + 1] * z[i] - t[i] * y[i + 2]
        print('%s a * %s = %s' % (i, u[i], v[i]))
print('-------------')
w = v[3] - v[1]
print('w', w)

p = w // (2**3 * 53831 * 1746716770613)
print('p', p)

a = inverse(y[0], p) * y[1] % p
print('a', a)

b = (x[1] - a * x[0]) % p
print('b', b)

flag = ''
for i in range(olen - 1):
    x[i + 1] = (a * x[i] + b) % p
print(x)
for i in range(olen):
    flag += chr(output[i] ^ x[i])
print(flag)

